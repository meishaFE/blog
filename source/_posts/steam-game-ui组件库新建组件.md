---
title: steam-game-uiç»„ä»¶åº“æ–°å»ºç»„ä»¶
date: 2019-10-29 20:00:00
tags: vueã€js
---

çº¦å®šä¼˜äºé…ç½®ï¼Œç®€å•è¯´å°±æ˜¯ç”¨çº¦å®šå¥½çš„è§„åˆ™ä½œä¸ºæ¡†æ¶æ¥å†™ä»£ç ã€‚åœ¨[steam-game-uiç»„ä»¶åº“](https://github.com/meishaFE/steam-game-ui)ä¸­ä¸€ä¸ªæ¯æ¬¡è¦æ–°åŠ ä¸€ä¸ªæ–°çš„ç»„ä»¶è¦åšä»¥ä¸‹å‡ ä»¶äº‹
<!-- more -->

- å¾€`packages`æ–‡ä»¶å¤¹é‡Œé¢æ·»åŠ ç»„ä»¶æ–‡ä»¶ã€æ–‡æ¡£å’Œå¯¼å‡ºç»„ä»¶çš„`index.js`
- åœ¨æ‰“åŒ…å…¥å£å¼•å…¥å’Œå¯¼å‡ºæ–°ç»„ä»¶
- å¾€`examples`æ–‡ä»¶å¤¹é‡Œé¢æ·»åŠ è·¯ç”±å¼•å…¥ç»„ä»¶ä»¥åŠæ·»åŠ å¯¼èˆª
- å¾€`tests`æ–‡ä»¶å¤¹é‡Œé¢æ·»åŠ å•å…ƒæµ‹è¯•æ–‡ä»¶
  
å®ƒä»¬çš„é…ç½®éƒ½æ˜¯åˆ†æ•£çš„ï¼Œä¸ç†Ÿæ‚‰é¡¹ç›®ç»“æ„çš„äººå®¹æ˜“å¿½ç•¥å…¶ä¸­çš„æŸä¸€ä¸ªæ­¥éª¤ï¼Œè€Œä¸”åˆ†æ•£çš„é…ç½®ä¹Ÿå®¹æ˜“å¯¼è‡´å‡ºé”™ï¼Œæ—¶é—´ä¸€é•¿æ¯æ¬¡æ·»åŠ ç»„ä»¶çš„æ—¶å€™å¯èƒ½è¿˜å¾—å…ˆæŸ¥çœ‹ä¸€ä¸‹ä»£ç é€»è¾‘ã€‚æ‰€ä»¥åœ¨`steam-game-ui`ä¸­æŠŠéƒ¨åˆ†é…ç½®å•ç‹¬æå–å‡ºæ¥ï¼ŒåŒæ—¶æ–°å¢`npm run new ç»„ä»¶å [ç»„ä»¶ä¸­æ–‡å]`å‘½ä»¤åˆå§‹åŒ–æ–°çš„ç»„ä»¶ã€‚

## åˆ›å»ºæ–°æ–‡ä»¶
ä¸€ä¸ªæ–°çš„ç»„ä»¶éœ€è¦æ–°å»ºä»¥ä¸‹æ–‡ä»¶ï¼š`packages/ç»„ä»¶/ç»„ä»¶.vue`ã€`packages/ç»„ä»¶/index.js`ã€`packages/ç»„ä»¶/docs/index.md`ã€`tests/specs/ç»„ä»¶.spec.js`ï¼Œä»–ä»¬çš„åˆå§‹åŒ–æ¨¡æ¿éƒ½æ˜¯å…±æ€§çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è·å–ç»„ä»¶çš„åç§°å’Œä¸­æ–‡åç§°å°±å¯ä»¥ç”Ÿæˆäº†ï¼Œè¿™é‡Œæ‹¿`packages/ç»„ä»¶/ç»„ä»¶.vue`ä¸¾ä¸ªç®€å•çš„ä¾‹å­ğŸ‘‡

```js
const Files = [{
    filename: path.join(`${ComponentName}.vue`),
    content: `<template>
                <div class="st-${componentname}">æ–°ç»„ä»¶</div>
            </template>
            <script>
                export default {
                    name: 'St${ComponentName}'
                };
            </script>`
}]
// åˆ›å»º package
Files.forEach(file => {
  fileSave(path.join(PackagePath, file.filename))
    .write(file.content, 'utf8')
    .end('\n');
});

```
æˆ‘ä»¬å†™äº†ä¸€ä¸ª`Files`çš„æ¨¡æ¿åˆ—è¡¨ï¼Œç„¶åæ¯ä¸€ä¸ªæ¨¡æ¿éœ€è¦æä¾›`filename`æ¨¡æ¿è·¯å¾„å’Œ`content`æ¨¡æ¿å†…å®¹ï¼Œç„¶åéå†åˆ—è¡¨ç”¨`fs`ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶ã€‚å…¶ä»–çš„æ–‡ä»¶ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªéœ€è¦å¾€`Files`åˆ—è¡¨é‡Œé¢æ–°å¢æ¨¡æ¿å°±å¯ä»¥äº†ï¼Œå…·ä½“çš„æ¨¡æ¿å‚è€ƒ`build/new.js`é‡Œé¢çš„é…ç½®ã€‚

## è‡ªåŠ¨å¼•å…¥ç»„ä»¶
åœ¨æ‰“åŒ…å…¥å£çš„`packages/index.js`éœ€è¦å¼•ç”¨å’Œå¯¼å‡ºç»„ä»¶ï¼ŒåŒæ—¶è¿˜éœ€è¦å¯¼å‡ºä¸€ä¸ª`install`æ–¹æ³•ï¼Œåœ¨`install`ä¸­é™¤äº†éƒ¨åˆ†ç»„ä»¶æœ‰æŒ‡ä»¤æˆ–è€…æœåŠ¡çš„æ–¹å¼è°ƒç”¨ï¼Œå…¶ä»–çš„éƒ½æ˜¯æ³¨å†Œä¸€ä¸‹ç»„ä»¶å°±å¯ä»¥äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„ç»„ä»¶åˆ—æˆä¸€ä»½ç»„ä»¶æ¸…å•`components.json`ï¼Œç„¶åæ ¹æ®è¿™ä»½ç»„ä»¶æ¸…å•å’Œæ¨¡æ¿å»è‡ªåŠ¨ç”Ÿæˆ`packages/index.js`ï¼Œå› ä¸ºæŒ‡ä»¤å’ŒæœåŠ¡è°ƒç”¨çš„ç»„ä»¶æœ‰é™ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„è°ƒç”¨æˆ‘ä»¬è¿˜æ˜¯å†™æ­»åœ¨æ¨¡æ¿é‡Œé¢ã€‚è¿™å—çš„å·¥ä½œå› ä¸ºå°±æ˜¯æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œæˆ‘æ”¾åœ¨`build\build-entry.js`é‡Œé¢ï¼ŒåŒæ—¶å› ä¸ºéœ€è¦ç”¨åˆ°æ’å€¼ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œéå†`components.json`ç„¶åæ¸²æŸ“æ¨¡æ¿ï¼Œæœ€åé€šè¿‡`fs`å»ç”Ÿæˆæ–‡ä»¶ã€‚

`components.json`çš„è‡ªåŠ¨ç”Ÿæˆè¿‡ç¨‹å’Œä¸Šé¢çš„ç”Ÿæˆæ–‡ä»¶ä¸€æ ·
```json
{
  "button": "packages/button/index.js",
  "icon": "packages/icon/index.js",
  "loading": "packages/loading/index.js",
  "message": "packages/message/index.js",
  "clickoutside": "packages/clickoutside/index.js"
}
```

`build\build-entry.js`åŒ…æ‹¬ä¸€ä¸ªæ¨¡æ¿å’Œæ¨¡æ¿çš„æ’å€¼é€»è¾‘ï¼Œç„¶åç”Ÿæˆæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡

```js
var components = require('./../components.json');
var fs = require('fs');
var render = require('json-templater/string');
var uppercamelcase = require('uppercamelcase');
var path = require('path');
var endOfLine = require('os').EOL;

var OUTPUT_PATH = path.join(__dirname, './../packages/index.js');
var IMPORT_TEMPLATE = 'import {{name}} from \'packages/{{package}}/index.js\';';
var INSTALL_COMPONENT_TEMPLATE = '  {{name}}';
var MAIN_TEMPLATE = `/* Automatically generated by './build/gen-components-index.js' */
{{include}}
import 'src/style/icon.scss';

const components = [
{{install}}
];

const install = function (Vue, opts = {}) {
  components.forEach(component => {
    Vue.component(component.name, component);
  });
  Vue.use(Loading.directive);
  Vue.directive('clickoutside', Clickoutside);
  Vue.prototype.$message = Message;
  Vue.prototype.$loading = Loading.service;
};

if (typeof window !== 'undefined' && window.Vue) {
  install(window.Vue);
}

export default {
  version: '{{version}}',
  install,
{{list}}
};
`;
var componentNames = Object.keys(components);
var includeComponentTemplate = [];
var installTemplate = [];
var listTemplate = [];
componentNames.forEach(name => {
  let componentName = uppercamelcase(name);
  includeComponentTemplate.push(render(IMPORT_TEMPLATE, {
    name: componentName,
    package: name
  }));
  if (['Loading', 'Message', 'Clickoutside'].indexOf(componentName) === -1) {
    installTemplate.push(render(INSTALL_COMPONENT_TEMPLATE, {
      name: componentName,
      component: name
    }));
  }
  if (['Loading', 'Message', 'Clickoutside', 'Icon'].indexOf(componentName) === -1) {
    listTemplate.push(`  ${componentName}`);
  }
});
var template = render(MAIN_TEMPLATE, {
  include: includeComponentTemplate.join(endOfLine),
  install: installTemplate.join(',' + endOfLine),
  version: process.env.VERSION || require('./../package.json').version,
  list: listTemplate.join(',' + endOfLine)
});

fs.writeFileSync(OUTPUT_PATH, template);
```

## é…ç½®å¯¼èˆª
è¿™ä¸€å—ä¹Ÿå•ç‹¬æŠ½æˆä¸€ä¸ªé€šç”¨é…ç½®`nav.config.json`ï¼Œè¿™é‡Œä¸ä»…æœ‰ç»„ä»¶çš„å¯¼èˆªä¹Ÿæœ‰ä¸€äº›å…¬å…±çš„æ–‡æ¡£çš„å¯¼èˆªï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å•ç‹¬ç”¨ä¸€ä¸ª`components`å­—æ®µæ¥ç»´æŠ¤ç»„ä»¶çš„å¯¼èˆªï¼Œåœ¨newæ–°ç»„ä»¶çš„æ—¶å€™å°±å¾€`components`é‡Œé¢pushæ–°çš„ç»„ä»¶ã€‚åœ¨å®˜ç½‘é‡Œé¢åªéœ€è¦è¯»å–è¿™ä»½jsonç„¶åæ·»åŠ åˆ°å¯¼èˆªä¸Šå°±å¯ä»¥äº†ã€‚

```json
{
	"guide": {
		"name": "å¼€å‘æŒ‡å—",
		"children": [{
			"name": "å¿«é€Ÿä¸Šæ‰‹",
			"path": "/quickstart",
			"docsPath": "examples/guide/quickstart.md"
		}, {
			"name": "å‚ä¸å¼€å‘",
			"path": "/develop",
			"docsPath": "examples/guide/develop.md"
		}]
	},
	"components": {
		"name": "ç»„ä»¶",
		"children": [
			{
				"name": "Icon å›¾æ ‡",
				"path": "/icon",
				"docsPath": "packages/icon/docs/index.md"
			}, {
				"name": "Button æŒ‰é’®",
				"path": "/button",
				"docsPath": "packages/button/docs/index.md"
			}
		]
	}
}
```

æ–°ç»„ä»¶çš„æ·»åŠ é€»è¾‘ğŸ‘‡

```js
// æ·»åŠ åˆ° nav.config.json
const navConfigFile = require('./../examples/nav.config.json');
navConfigFile['components'].children.push({
  name: componentname !== chineseName ? `${ComponentName} ${chineseName}` : ComponentName,
  path: `/${componentname}`,
  docsPath: `packages/${componentname}/docs/index.md`
});

fileSave(path.join(__dirname, './../examples/nav.config.json'))
  .write(JSON.stringify(navConfigFile, null, '  '), 'utf8')
  .end('\n');
```

## é…ç½®è·¯ç”±
è·¯ç”±çš„é…ç½®åŒæ ·ä¹Ÿæ˜¯ä¾æ®`nav.config.json`è¿™ä»½é…ç½®ï¼Œå› ä¸ºæˆ‘ä»¬æŠŠæ¨¡å—çš„è·¯å¾„é€šè¿‡å˜é‡çš„æ–¹å¼æå–å‡ºæ¥äº†ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªå…³äº[ä¾èµ–ç®¡ç†](https://webpack.docschina.org/guides/dependency-management/)çš„çŸ¥è¯†ç‚¹ã€‚æˆ‘ä»¬çŸ¥é“webpackæ˜¯é™æ€ç¼–è¯‘ï¼Œå½“`require`çš„è·¯å¾„æœ‰è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œç¼–è¯‘é˜¶æ®µæ— æ³•çŸ¥é“è¦å¼•å…¥å“ªäº›æ–‡ä»¶ã€‚ä½†æ˜¯webpackä¼šæ ¹æ®è¡¨è¾¾å¼çš„å†…å®¹åŒºæ‹†åˆ†æˆä¸€ä¸ªè·¯å¾„å’Œæ–‡ä»¶åï¼Œç„¶åæŠŠè·¯å¾„ä¸‹çš„æ–‡ä»¶å…¨éƒ¨å¼•å…¥ï¼Œå½“è¿è¡Œæ—¶çš„æ—¶å€™å†å»è§£æè¡¨è¾¾å¼ï¼Œç„¶åå»åŒ¹é…å¼•å…¥çš„æ–‡ä»¶ã€‚æ‰€ä»¥`webpack`èƒ½å¤Ÿæ”¯æŒåŠ¨æ€åœ°`require`ï¼Œä½†ä¼šå¯¼è‡´æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„æ¨¡å—éƒ½åŒ…å«åœ¨`bundle` ä¸­ã€‚ä½†æ˜¯é€šè¿‡`require.context`å¯ä»¥è®©æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç¬¦åˆæˆ‘ä»¬è‡ªå®šä¹‰è§„åˆ™çš„å¼•ç”¨ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·å°±èƒ½å¤Ÿç²¾å‡†å¾—è·å–åˆ°æˆ‘ä»¬åªéœ€è¦ç”¨åˆ°çš„æ¨¡å—ã€‚è¯­æ³•å¦‚ä¸‹

```js
require.context(directory, useSubdirectories = false, regExp = /^\.\//);
```
é¡¹ç›®å†…çš„å…·ä½“é…ç½®å¦‚ä¸‹ğŸ‘‡

```js
import Vue from 'vue';
import navConfig from './nav.config';
import Router from 'vue-router';
import Home from './views/Home.vue';
Vue.use(Router);

let navs = [];
const componentsContext = require.context('./../packages/', true, /\.md/);
const componentsContextKeys = componentsContext.keys();
const guideContext = require.context('./../examples/', true, /\.md/);
const guideContextKeys = guideContext.keys();
Object.keys(navConfig).forEach(group => {
  navConfig[group].children.forEach(nav => {
    if (nav.path && nav.docsPath) {
      let docsPath = nav.docsPath.replace(/examples|packages/, '.');
      let isGuide = guideContextKeys.indexOf(docsPath) > -1;
      let isComponent = componentsContextKeys.indexOf(docsPath) > -1;
      if (isGuide || isComponent) {
        navs.push({
          path: nav.path,
          component: isGuide ? guideContext(docsPath).default : componentsContext(docsPath).default
        });
      }
    }
  });
});
let router = {
  mode: 'history',
  base: process.env.BASE_URL,
  routes: [
    {
      path: '/',
      name: 'home',
      component: Home,
      children: navs
    }
  ]
};
export default new Router(router);

```

## æ€»ç»“
ç»è¿‡ä¸Šé¢çš„å·¥ä½œï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä½¿ç”¨`npm run new ç»„ä»¶å [ç»„ä»¶ä¸­æ–‡å]`å‘½ä»¤æ¥åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ç»„ä»¶äº†ï¼Œå…·ä½“çš„ä»£ç æŸ¥çœ‹`build/new.js`ï¼Œ[ä»“åº“åœ°å€](https://github.com/meishaFE/steam-game-ui)
